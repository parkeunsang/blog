<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[Python] 바이낸스 API를 이용한 선물거래(매매)</title>
  <meta name="description" content="요약지난 포스트 에서 바이낸스 API를 활용해 OHLC 데이터 수집을 해보았다. 이번 포스트에서는 API를 이용해 현재 보유종목 확인, 선물 거래를 하는 코드를 구현해보고자 한다. CCTX나 binance와 같은 python library를 통해 위의 기능을 좀 더 쉽게 구현할 수...">
  
  <meta name="author" content="EunSang Park">
  <meta name="copyright" content="&copy; EunSang Park 2023">
  

  <!-- External libraries --> 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/blog/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/blog/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/blog/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/blog/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/blog/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/blog/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/blog/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/blog/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/blog/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/blog/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/blog/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/blog/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/blog/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="요약지난 포스트 에서 바이낸스 API를 활용해 OHLC 데이터 수집을 해보았다. 이번 포스트에서는 API를 이용해 현재 보유종목 확인, 선물 거래를 하는 코드를 구현해보고자 한다. CCTX나 binance와 같은 python library를 통해 위의 기능을 좀 더 쉽게 구현할 수..." />
  <meta property="og:url" content="https://parkeunsang.github.io/stock/2022/05/10/python-api.html">
  <meta property="og:site_name" content="Edward's blog" />
  <meta property="og:title" content="[Python] 바이낸스 API를 이용한 선물거래(매매)" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://parkeunsang.github.io/blog/assets/instacode.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="[Python] 바이낸스 API를 이용한 선물거래(매매)">
  <meta name="twitter:description" content="요약지난 포스트 에서 바이낸스 API를 활용해 OHLC 데이터 수집을 해보았다. 이번 포스트에서는 API를 이용해 현재 보유종목 확인, 선물 거래를 하는 코드를 구현해보고자 한다. CCTX나 binance와 같은 python library를 통해 위의 기능을 좀 더 쉽게 구현할 수...">
  <meta name="twitter:image" content="https://parkeunsang.github.io/blog/assets/instacode.png">
  <meta name="twitter:url" content="https://parkeunsang.github.io/stock/2022/05/10/python-api.html">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/blog/css/main.css">
  <link rel="canonical" href="https://parkeunsang.github.io/blog/stock/2022/05/10/python-api.html">
	<link rel="alternate" type="application/rss+xml" title="Edward's blog" href="https://parkeunsang.github.io/blog/feed.xml" />
	
	<!-- Tooltips -->
	<script type="text/javascript">
		window.tooltips = []
	</script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/blog/" class="logo">
      
      <img src="/blog/assets/homepage.png" alt="Edward's blog">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
				
	
	<li class="nav-link"><a href="/blog/about/">About</a>
	

	
	<li class="nav-link"><a href="/blog/category/">Categories</a>
	

	

	

	
	<li class="nav-link"><a href="/blog/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container has-cover" style="background-image: url(/blog/assets/instacode.png);">
  <div class="scrim has-cover">
    <header class="post-header">
      <h1 class="title">[Python] 바이낸스 API를 이용한 선물거래(매매)</h1>
      <p class="info">by <strong>Edward Park</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">



<section class="post-meta">
  <div class="post-date">May 10, 2022</div>
  <div class="post-categories">
  in 
    
    <a href="/blog/posts">Stock</a>
    
  
  </div>
</section>

<article class="post-content">
  <h2 id="요약">요약</h2>
<p><a href="https://parkeunsang.github.io/blog/stock/2021/06/11/python-api.html">지난 포스트</a> 에서 <strong>바이낸스 API</strong>를 활용해 OHLC 데이터 수집을 해보았다. <br />
이번 포스트에서는 API를 이용해 <strong>현재 보유종목 확인, 선물 거래</strong>를 하는 코드를 구현해보고자 한다. <br />
CCTX나 binance와 같은 python library를 통해 위의 기능을 좀 더 쉽게 구현할 수도 있으나, 직접 API를 이용하는게 <strong>보안과 기능의 확장성</strong> 측면에서 좋다고 판단해 위의 library들은 사용하지 않았다. <br /></p>

<h2 id="1-api-key발급">1. API Key발급</h2>
<p>가격조회가 아닌 개인 계정을 이용해 매수, 매도를 하는 것이므로 먼저 바이낸스 계정의 API키를 발급해야 한다.</p>
<ol>
  <li>binance 사이트에서 profile 아이콘을 누르고 API Management에 들어간다.
<img src="/blog/post_images/binance/api_1.png" title="api" /></li>
  <li>Create API 왼쪽의 input box에 API 이름을 입력하고, Create API를 눌러 API를 생성한다.</li>
  <li>이때 생성된 <font color="red">API Key와 Secret Key</font>는 선물 거래에 사용되니 기록해두어야하며(특히 Secret Key는 한번 생성하면 나중에 다시 확인할 수 없다), 유출되지 않게 유의해야한다.</li>
  <li>Edit 버튼을 눌러 <strong>Enable Future</strong> 를 체크하고, Save버튼을 눌러 저장한다. 
<img src="/blog/post_images/binance/api_2.png" title="api" /></li>
</ol>

<h2 id="2-계좌-잔고-주문내역-상태-조회">2. 계좌 잔고, 주문내역, 상태 조회</h2>
<p>API Key의 경우 보안을 위해 환경변수로 저장하는게 낫다. <a href="https://parkeunsang.github.io/blog/python/2021/07/06/api-key.html">환경 변수를 이용한 API Key관리</a> 참고<br />
이하 코드에 등장하는 API 요청은  <a href="https://binance-docs.github.io/apidocs/futures/en/#public-endpoints-info">바이낸스 API 공식 문서</a> 를 참고했다.</p>
<pre><code class="language-Python">import requests as rq
import hmac
import hashlib

# 위에서 확인한 api key, secret key
API_KEY = 'your api key'
SECRET_KEY = 'your secret key'
URL = 'https://fapi.binance.com'
headers = {
    'X-MBX-APIKEY': API_KEY
}

def get_user_data(url_sub):
    now = rq.get('https://api.binance.com/api/v3/time').json()['serverTime']  # 현재 시점
    message = f'timestamp={now}'
    signature = hmac.new(key=SECRET_KEY.encode('utf-8'), msg=message.encode('utf-8'),
                 digestmod=hashlib.sha256).hexdigest()
    url = f'{URL}{url_sub}?{message}&amp;signature={signature}'
    result = rq.get(url, headers = headers)
    return result.json()

balance = get_user_data('/fapi/v2/balance')  # 내 계좌 잔고
order_log = get_user_data('/fapi/v1/allOrders')  # 내 주문 내역
account = get_user_data('/fapi/v2/account')  # 내 계좌 정보
print(balance)
</code></pre>
<ul>
  <li>GET요청으로 현재 내 계좌 정보를 조회할 수 있다.</li>
  <li>일반적인 api get 요청과 다르게 <strong>현재 시점</strong>과 <strong>signature</strong>를 url에 담아서 요청해야한다. signature는 서명에 해당하는 내용으로, secret key의 해쉬값을 의미한다.</li>
</ul>

<h2 id="3-선물-매수매도">3. 선물 매수/매도</h2>
<p>매수, 매도의 경우 계좌의 데이터를 변경하는 것이기 때문에 <strong>POST</strong>요청을 사용한다.</p>
<pre><code class="language-Python">def order(symbol, side, quantity)-&gt; int:
    now = rq.get('https://api.binance.com/api/v3/time').json()['serverTime']  # 현재 시점
    if quantity &gt;= 10:
        quantity = str(int(quantity))
    else:
        quantity = str(quantity)
        quantity = quantity[:5]
        if quantity.endswith('.'):
            quantity = quantity[:-1]
    if side == 1:
        side = 'BUY'
    else:
        side = 'SELL'
    message = f'symbol={symbol}&amp;side={side}&amp;type=MARKET&amp;quantity={quantity}&amp;timestamp={now}'
    signature = hmac.new(key=SECRET_KEY.encode('utf-8'), msg=message.encode('utf-8'),
                 digestmod=hashlib.sha256).hexdigest()
    url = f'{URL}/fapi/v1/order?{message}&amp;signature={signature}'
    result = rq.post(url, headers = headers)
    return result.status_code
		
symbol = 'IOTAUSDT'
side = 'SELL'  # or BUY
quantity = 20
status_code = order(symbol, side, quantity)
print(status_code)  # 200이 프린트되면 정상적으로 주문된것
</code></pre>
<ul>
  <li>위의 코드는 <strong>IOTAUSDT</strong>를 <font color="red">시장가(Market)</font>로 20개 Sell(Short)하는 코드이다.</li>
  <li>만약 Leveraeg가 20배이고, IOTAUSDT가 현재 1$ 이면 내가 투자한 금액은 1$가 된다.</li>
  <li>총 <strong>매수/매도하는 금액이 너무 작거나 수량의 소수점 아래 수가 너무 많으면</strong> 정상적으로 주문이 처리되지않아 중간에 이를 조정하는 부분을 넣었다.
<img src="/blog/post_images/binance/api_3.png" title="api" /></li>
</ul>

<h2 id="마무리">마무리</h2>
<p>필자의 경우 OHLC데이터만 사용해 RNN기반 가격예측 모델을 만드는것을 시도했으나, 수수료를 이길(시장가 매매의 경우 한번 사고팔때 약 0.1%의 수수료 발생) 전략을 구현하지는 못했다. 이 과정에서 트레이딩 경험이 적어 데이터를 보는 인사이트가 매우 부족하다고 느꼈다. <br />
그래서 <strong>트레이딩에 도메인 Knowledge</strong>가 있으신 분들과 함께 협업하면 시너지가 잘 나올 것 같아 이러한 알고리즘 매매에 관심있으신 분들은  <code class="language-plaintext highlighter-rouge">edwardfdsp@gmail.com</code>로 메일 주시면 감사하겠습니다.</p>

</article>
<!-- <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script> -->



<section class="tags">
  <!-- <strong>Tags:</strong> <a href="/blog/tag/Bitcoin">Bitcoin</a> -->
  <strong>Tags:</strong> <a href="https://www.google.co.kr/search?q=Bitcoin">Bitcoin</a>
</section>


<!-- <section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/blog/feed.xml">via RSS</a></strong></p>
</section> -->

<section class="share">
  <span>Share: </span>
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
      <a href="//www.pinterest.com/pin/create/button/?description=%5BPython%5D+%EB%B0%94%EC%9D%B4%EB%82%B8%EC%8A%A4+API%EB%A5%BC+%EC%9D%B4%EC%9A%A9%ED%95%9C+%EC%84%A0%EB%AC%BC%EA%B1%B0%EB%9E%98%28%EB%A7%A4%EB%A7%A4%29&url=https%3A%2F%2Fparkeunsang.github.io%2Fblog%2Fstock%2F2022%2F05%2F10%2Fpython-api.html&media=https://parkeunsang.github.io/blog/assets/instacode.png"
        onclick="window.open(this.href, 'pinterest-share', 'width=550,height=255');return false;">
        <i class="fa fa-pinterest-square fa-lg"></i>
      </a>
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
      <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent('https://parkeunsang.github.io/blog/stock/2022/05/10/python-api.html') + '&title=[Python] 바이낸스 API를 이용한 선물거래(매매)'; return false">
        <i class="fa fa-reddit-square fa-lg"></i>
      </a>
    
    
  
    
    
    
    
    
    
    
    
  
</section>




</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">Edward's blog</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
				
	
	<li class="nav-link"><a href="/blog/about/">About</a>
	

	
	<li class="nav-link"><a href="/blog/category/">Categories</a>
	

	

	

	
	<li class="nav-link"><a href="/blog/posts/">Posts</a>
	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	

	


      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:edwardfdsp@gmail.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">edwardfdsp@gmail.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://github.com/parkeunsang" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">EunSang Park</span>
            </a>
          </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

      </ul>
    </div>

    <!-- <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/blog/feed.xml">via RSS</a></strong></p>
      <p class="text">contents
</p>
    </div> -->

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.1/js/lightbox.min.js"></script>
<script src="//unpkg.com/popper.js@1"></script>
<script src="//unpkg.com/tippy.js@5"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });

	// Enable tooltips via Tippy.js
	if (Array.isArray(window.tooltips)) {
		window.tooltips.forEach(function(tooltip) {
			var selector = tooltip[0];
			var config = tooltip[1];
			tippy(selector, config);
		})
	}
});

</script>






  </body>

</html>
